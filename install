#!/bin/sh

read -p "ACDC local folder [~/.acdc]: " -r acdc_local_folder
acdc_local_folder=${acdc_local_folder:-"~/.acdc"}
acdc_local_folder="${acdc_local_folder/#\~/$HOME}"

# Create folder structure
if [ -d $acdc_local_folder ]; then
    echo "The folder $acdc_local_folder already exists."
    read -p "Do you want to replace it?(y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        rm -rf $acdc_local_folder
    else
        exit 0
    fi
fi

here=$(pwd)
mkdir $acdc_local_folder
mkdir $acdc_local_folder/toolkit
shopt -s dotglob
mv * $acdc_local_folder/toolkit
rm -r $here

# Create the 'acdc' alias
read -p "Do you want to create an 'acdc' alias?(y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    acdc_alias="cd $acdc_local_folder/toolkit
    pipenv run ./toolkit.py
    if [ \"\$?\" -eq 1 ]; then
        pipenv install
        pipenv run ./toolkit.py
    fi"

    echo '---'
    echo ''

    cat ~/.bashrc | grep 'alias acdc' 1>/dev/null 2>/dev/null
    if [ "$?" -eq 1 ]; then
        echo -e "# ACDC\nalias acdc='$acdc_alias'" >> ~/.bashrc

        echo 'Please run the command:'
        echo '  42sh$ source ~/.bashrc'
        echo ''
    else
        echo 'acdc alias already created'
        echo ''
    fi

    echo 'To use the toolkit, run the command:'
    echo '  42sh$ acdc'
    echo ''
fi

echo "You can add/remove logins by editting the file at:"
echo "  $acdc_local_folder/logins.txt"
echo ''

echo "Toolkit successfully installed in $acdc_local_folder"
